"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const Debug_1 = require("../Debug");
const jsonpatch = require("fast-json-patch");
class JSONPatchSerializer {
    constructor() {
        this.id = "json-patch";
    }
    reset(newState) {
        this.state = newState;
        this.observer = jsonpatch.observe(newState);
    }
    getData() {
        return this.state;
    }
    hasChanged(newState) {
        this.patches = jsonpatch.generate(this.observer);
        const changed = (this.patches.length > 0);
        if (changed) {
            //
            // debugging
            //
            if (Debug_1.debugPatch.enabled) {
                Debug_1.debugPatch('%d bytes, %j', this.patches.length, this.patches);
            }
            this.state = newState;
        }
        return changed;
    }
    getPatches() {
        return this.patches;
    }
}
exports.JSONPatchSerializer = JSONPatchSerializer;
